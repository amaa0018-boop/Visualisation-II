{
    "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
    "params": [
        {
            "name": "searchLGA",
            "value": "",
            "bind": {
                "input": "text",
                "name": "Search a Region: "
            }
        }
    ],
    "hconcat": [
        {   
            "width": 800,
            "height": 600,
            "layer": [
                {
                    "data": {
                        "url": "data/LGA_2021_AUST_GDA2020_10pct.json",
                        "format": {"type": "topojson", "feature":"LGA_2021_AUST_GDA2020"}
                    },
                    "transform": [
                        {
                            "lookup": "properties.LGA_CODE21",
                            "from": {
                                "data": {"url": "data/2021_WPP_VIC_LGA.csv"},
                                "key": "POW_LGA_CODE_2021",
                                "fields": ["P_Tot_EWFT"]
                            }
                        },
                        {
                            "filter": "datum.properties.STE_NAME21 === 'Victoria'"
                        }
                    ],
                    "mark": {
                        "type": "geoshape",
                        "stroke": "white"
                    },
                    "encoding": {
                        "fill": {
                            "condition": {
                                "test": "searchLGA != '' ? lower(slice(datum.properties.LGA_NAME21, 0, length(searchLGA))) === lower(searchLGA) : true",
                                "field": "P_Tot_EWFT",
                                "type": "quantitative",
                                "scale": {"scheme": "blues", "type": "log"}, 
                                "legend": {"orient": "top-left"}
                            },
                            "value": "#DDDDDD"
                        },
                        "tooltip": [
                            {"field": "properties.LGA_NAME21"},
                            {"field": "properties.LGA_CODE21"},
                            {"field": "P_Tot_EWFT"}
                        ]
                    }
                }
            ]
        },
        {
            "data": {"url": "data/2021_WPP_VIC_LGA_AD.csv"},
            "title": "Male",
            "mark": "bar",
            "transform": [
                {
                    "filter": "searchLGA != '' ? lower(slice(datum.LGAName, 0, length(searchLGA))) === lower(searchLGA) : true"
                },
                {
                    "filter": "datum.Sex == 'M'"
                }
            ],
            "encoding": {
                "x": {"field": "AgeBracket", "type": "nominal"},
                "y": {"aggregate": "sum", "field": "NumPeople", "type": "quantitative"},
                "color": {
                    "field": "EmploymentType", 
                    "type": "nominal", 
                    "sort": "descending", 
                    "scale": {
                        "domain": ["Hours Worked Not Stated", "Away From Work", "Working Part Time", "Working Full Time"], 
                        "scheme": "purples"
                    }
                },
                "order": {"aggregate": "sum", "field": "yield"}
            }
        },
        {
            "data": {"url": "data/2021_WPP_VIC_LGA_AD.csv"},
            "title": "Female",
            "mark": "bar",
            "transform": [
                {
                    "filter": "searchLGA != '' ? lower(slice(datum.LGAName, 0, length(searchLGA))) === lower(searchLGA) : true"
                },
                {
                    "filter": "datum.Sex == 'F'"
                }
            ],
            "encoding": {
                "x": {"field": "AgeBracket", "type": "nominal"},
                "y": {"aggregate": "sum", "field": "NumPeople", "type": "quantitative"},
                "color": {"field": "EmploymentType", "type": "nominal", "sort": "descending"},
                "order": {"aggregate": "sum", "field": "yield"}
            }
        }
    ]
}